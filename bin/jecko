#!/usr/bin/env node

const path = require('path');
const { spawn } = require('child_process');

// Get the directory where this script is located
const binDir = __dirname;
const projectRoot = path.join(binDir, '..');
const mainScript = path.join(projectRoot, 'dist', 'index.js');

// Check if we have a built version, otherwise use tsx for development
const fs = require('fs');
if (fs.existsSync(mainScript)) {
  // Production: use built JavaScript
  require(mainScript);
} else {
  // Development: use tsx to run TypeScript directly
  const tsxPath = path.join(projectRoot, 'node_modules', '.bin', 'tsx');
  const srcScript = path.join(projectRoot, 'src', 'index.ts');
  
  if (fs.existsSync(tsxPath)) {
    const child = spawn(tsxPath, [srcScript, ...process.argv.slice(2)], {
      stdio: 'inherit',
      cwd: projectRoot
    });
    
    child.on('exit', (code) => {
      process.exit(code || 0);
    });
  } else {
    console.error('Error: Neither built version nor tsx found. Please run "npm install" first.');
    process.exit(1);
  }
}